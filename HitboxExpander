-- Функция для сброса хитбоксов тиммейтов
local function resetTeamHitboxes(localPlayer, localTeam)
    for _, v in ipairs(game:GetService('Players'):GetPlayers()) do
        if v ~= localPlayer and v.Team == localTeam and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
            local rootPart = v.Character.HumanoidRootPart
            rootPart.Size = Vector3.new(2, 2, 1) -- Восстанавливаем оригинальный размер
            rootPart.Transparency = 1
            rootPart.Material = "Plastic"
        end
    end
end

-- Основной код для управления хитбоксами
local function updateHitbox(v, headSize, hitboxTransparency, hitboxColor)
    if v ~= game:GetService('Players').LocalPlayer and v.Character and v.Character:FindFirstChild("Humanoid") and v.Character:FindFirstChild("HumanoidRootPart") then
        local humanoid = v.Character.Humanoid
        local rootPart = v.Character.HumanoidRootPart

        if humanoid.Health > 0 then
            rootPart.Size = Vector3.new(headSize, headSize, headSize)
            rootPart.Transparency = hitboxTransparency
            rootPart.Color = hitboxColor
            rootPart.Material = "Neon"
            rootPart.CanCollide = false
        else
            rootPart.Size = Vector3.new(2, 2, 1) -- Восстанавливаем оригинальный размер
            rootPart.Transparency = 1
        end
    end
end

-- Запуск цикла для сброса хитбоксов
game:GetService('RunService').Heartbeat:Connect(function(deltaTime)
    local localPlayer = game:GetService('Players').LocalPlayer
    local localTeam = localPlayer.Team
    local teamCheck = true -- Настройка для проверки команды

    if teamCheck then
        resetTeamHitboxes(localPlayer, localTeam)
    end
end)

game:GetService('RunService').RenderStepped:Connect(function()
    local localPlayer = game:GetService('Players').LocalPlayer
    local localTeam = localPlayer.Team
    local disabled = false -- Настройка для отключения
    local headSize = 2 -- Размер хитбокса
    local hitboxTransparency = 0.5 -- Прозрачность хитбокса
    local hitboxColor = Color3.new(1, 0, 0) -- Цвет хитбокса

    for _, v in ipairs(game:GetService('Players'):GetPlayers()) do
        if v.Name ~= localPlayer.Name then
            local isSameTeam = teamCheck and v.Team == localTeam
            if not disabled and not isSameTeam then
                pcall(function()
                    updateHitbox(v, headSize, hitboxTransparency, hitboxColor)
                end)
            end
        end
    end
end)

game:GetService('Players').PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        wait(0.1)
        local disabled = false -- Настройка для отключения
        local headSize = 2 -- Размер хитбокса
        local hitboxTransparency = 0.5 -- Прозрачность хитбокса
        local hitboxColor = Color3.new(1, 0, 0) -- Цвет хитбокса

        if not disabled then
            pcall(function()
                updateHitbox(player, headSize, hitboxTransparency, hitboxColor)
            end)
        end

        -- Подписываемся на событие смерти один раз при создании персонажа
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.Died:Connect(function()
                local rootPart = character:FindFirstChild("HumanoidRootPart")
                if rootPart then
                    rootPart.Size = Vector3.new(2, 2, 1) -- Восстанавливаем оригинальный размер
                    rootPart.Transparency = 1
                    rootPart.Material = "Plastic"
                end
            end)
        end
    end)
end)
